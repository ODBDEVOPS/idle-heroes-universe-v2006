<div class="h-full w-full flex flex-col bg-gray-900 animate-fadeIn overflow-hidden relative">
  <!-- Dynamic Background -->
  <div class="absolute inset-0 bg-gradient-to-br from-indigo-900 via-purple-900 to-black animate-bg-pan" style="background-size: 200% 200%;"></div>
  <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_top_left,rgba(233,213,255,0.1)_0%,transparent_50%)] animate-bg-float" style="animation-duration: 30s;"></div>
  <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_bottom_right,rgba(199,210,254,0.1)_0%,transparent_50%)] animate-bg-float" style="animation-duration: 40s; animation-direction: reverse;"></div>

  <!-- Starfield Parallax Layer -->
  <div class="absolute inset-0 z-0 pointer-events-none animate-bg-float" style="animation-duration: 120s;">
    <div class="star-particle bg-purple-400/50" style="top: 10%; left: 15%; animation-delay: 0s;"></div>
    <div class="star-particle bg-indigo-400/50" style="top: 85%; left: 90%; animation-delay: 1.5s;"></div>
    <div class="star-particle bg-purple-300/50" style="top: 50%; left: 50%; animation-delay: 3s; width: 3px; height: 3px;"></div>
  </div>

  <!-- Color grading and vignette -->
  <div class="absolute inset-0 bg-gradient-to-br from-purple-800 to-indigo-700 opacity-20 mix-blend-soft-light"></div>
  <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_center,transparent_60%,rgba(0,0,0,0.8)_100%)]"></div>

  <!-- Header -->
  <header class="relative z-20 p-4 flex justify-between items-center bg-black/30 backdrop-blur-sm border-b border-purple-500/30">
    <div>
      <h1 class="text-2xl font-orbitron text-white">Dimensional Rift</h1>
      <p class="text-lg font-semibold text-purple-300">Level {{ gameService().gameState().riftLevel }}</p>
    </div>
    <button (click)="leaveRift()" class="px-4 py-2 bg-red-600 text-white font-bold rounded-md hover:bg-red-700 transition-colors">Leave Rift</button>
  </header>

  @if(gameService().currentRiftEnemy(); as enemy) {
    <!-- Enemy Area -->
    <div class="flex-grow flex flex-col items-center justify-center relative z-10 p-4 pt-12">
      <!-- Enemy Info -->
      <div class="text-center mb-2">
        <div class="flex items-center justify-center gap-3">
            <h2 class="text-2xl font-bold font-orbitron text-purple-200 drop-shadow-md">{{ enemy.name }}</h2>
            <div class="flex items-center gap-1">
                @for(anomaly of enemy.anomalies; track anomaly.id) {
                <div class="bg-indigo-900/70 border border-indigo-600 p-1.5 rounded-full flex items-center" [appTooltip]="anomaly.name + ': ' + anomaly.description">
                    <span class="text-base">{{ anomaly.icon }}</span>
                </div>
                }
            </div>
        </div>
        <p class="text-lg text-gray-200 mt-1">{{ formatNumber(enemy.currentHp) }} / {{ formatNumber(enemy.maxHp) }}</p>
      </div>

      <!-- Enemy Health Bar -->
      <div class="w-full max-w-md bg-black/50 rounded-full h-6 border-2 border-purple-500 mb-2 relative overflow-hidden">
        <div class="absolute top-0 left-0 h-full bg-yellow-400/80 rounded-full transition-all duration-300 ease-out" [style.width.%]="delayedEnemyHpPercentage()"></div>
        <div class="absolute top-0 left-0 h-full bg-purple-600 rounded-full transition-all duration-150 ease-linear" [style.width.%]="enemyHpPercentage()" [class.animate-hp-bar-hit]="healthBarHit()"></div>
      </div>

      <!-- Enemy ASCII Art -->
      <div class="relative mt-4">
        <pre (click)="onEnemyClick()" class="text-3xl md:text-4xl text-center text-purple-300 font-mono cursor-pointer select-none drop-shadow-[0_0_10px_rgba(192,132,252,0.5)] p-4 transition-transform duration-100 ease-out hover:scale-105 active:scale-95 leading-tight" 
             [class.animate-shake]="gameService().enemyIsShaking()"
             [class.animate-elite-glow]="enemy.isElite">{{ enemy.asciiArt }}</pre>

        @for(flash of gameService().damageFlashes(); track flash.id) {
          <div class="absolute top-1/2 font-orbitron font-bold pointer-events-none drop-shadow-lg whitespace-nowrap" [style.left.%]="flash.x" [class.animate-floating-damage]="flash.type !== 'skill'" [class.animate-skill-damage-pop]="flash.type === 'skill'" [class.text-yellow-300]="flash.type === 'click'" [class.text-3xl]="flash.type === 'click'" [class.text-cyan-300]="flash.type === 'skill'" [class.text-5xl]="flash.type === 'skill'" [class.text-white]="flash.type === 'dps'" [class.text-xl]="flash.type === 'dps'">
            {{ formatNumber(flash.damage) }}
          </div>
        }
      </div>
    </div>
    
    <!-- Hero Bar -->
    <div class="relative z-10 p-2 bg-black/30 backdrop-blur-sm">
      <div class="flex justify-center items-end flex-wrap gap-2">
        @for (hero of gameService().activeHeroes(); track hero.id) {
          <div class="flex flex-col items-center group" [appTooltip]="hero.name + ' (Lvl ' + hero.level + ')'">
            <div (click)="activateSkill(hero.id)"
                  class="relative w-14 h-14 rounded-lg border-2 flex items-center justify-center font-bold text-xl transition-all duration-200 overflow-hidden shadow-lg"
                  [class]="getRarityBorderClass(hero.rarity)" [class.animate-skill-ready]="hero.skillReady" [class.animate-skill-ready-breathe]="hero.skillReady" [class.cursor-pointer]="hero.skillReady" [class.hover:scale-110]="hero.skillReady" [class.hover:border-white]="hero.skillReady" [class.animate-skill-activate-flash]="activatingSkillHeroId() === hero.id" [class]="getRarityBgClass(hero.rarity)">
              <span class="font-orbitron text-2xl text-white drop-shadow-md z-10">{{ hero.name.charAt(0) }}{{ hero.name.split(' ')[1]?.charAt(0) || '' }}</span>
              <div class="absolute -top-1 -left-1 bg-black/70 px-1.5 py-0.5 rounded-br-md z-20"><span class="text-xs font-bold text-gray-300">Lvl {{ hero.level }}</span></div>
              @if(hero.skillReady) { <div class="absolute inset-0 bg-black/50 flex items-center justify-center z-20 opacity-0 group-hover:opacity-100 transition-opacity"><span class="text-sm font-bold text-cyan-300">READY</span></div> }
            </div>
            <div class="w-14 h-1.5 bg-black/50 rounded-full mt-1 overflow-hidden border border-gray-600"><div class="h-full bg-cyan-400 rounded-full" [style.width.%]="hero.skillCharge"></div></div>
          </div>
        }
      </div>
    </div>
  } @else {
    <div class="flex-grow flex flex-col items-center justify-center text-center text-gray-500">
      <svg class="animate-spin h-12 w-12 text-purple-400 mb-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24"><circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle><path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path></svg>
      <p class="text-xl font-semibold">Entering the Rift...</p>
    </div>
  }
</div>