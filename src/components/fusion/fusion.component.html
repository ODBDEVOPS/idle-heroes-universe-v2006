<div class="h-full w-full bg-gray-800 flex flex-col animate-fadeIn overflow-hidden">
  <header class="text-center p-4 border-b-2 border-gray-700/50 flex-shrink-0">
    <h1 class="text-3xl font-orbitron text-purple-400">Hero Fusion</h1>
    <p class="text-gray-400">Ascend heroes to unlock their true potential.</p>
  </header>
  
  <div class="flex-grow flex flex-col md:flex-row overflow-hidden">
    <!-- Hero List -->
    <div class="w-full md:w-1/3 lg:w-2/5 flex flex-col border-b-2 md:border-b-0 md:border-r-2 border-gray-700/50">
      <div class="p-2 bg-gray-900/50 flex-shrink-0">
        <h2 class="text-lg font-orbitron text-gray-300 text-center">Select a Hero to Ascend</h2>
      </div>
      <div class="flex-grow overflow-y-auto p-2">
        <div class="grid grid-cols-1 gap-2">
          @for(hero of fusibleHeroes(); track hero.id) {
            <button (click)="selectHero(hero.id)" class="p-2 w-full rounded-lg flex items-center gap-3 text-left transition-colors duration-200" [class.bg-purple-900/50]="selectedHeroId() === hero.id" [class.hover:bg-gray-700/60]="selectedHeroId() !== hero.id">
              <div class="w-12 h-12 rounded-md flex-shrink-0 flex items-center justify-center border-2 text-xl font-bold" [class]="getRarityBorderClass(hero.rarity)">{{ getHeroInitials(hero.name) }}</div>
              <div class="flex-grow">
                <p class="font-bold text-white">{{ hero.name }}</p>
                <p class="text-xs text-gray-400">Ascension: ‚≠ê {{ hero.ascensionLevel }}</p>
              </div>
            </button>
          }
        </div>
      </div>
    </div>
    
    <!-- Fusion Interface -->
    <div class="w-full md:w-2/3 lg:w-3/5 flex-grow overflow-y-auto relative p-4 flex items-center justify-center">
      @if(selectedHero(); as hero) {
        @let cost = fusionCost()!;
        @let afterStats = statsAfterFusion()!;
        <div class="w-full max-w-2xl animate-content-fade-in space-y-4">
          
          <div class="grid grid-cols-5 items-center gap-2 text-center relative">
            
            <!-- MATERIALS -->
            <div class="col-span-2 flex flex-col items-center justify-start p-4 bg-gray-900/50 rounded-lg h-full">
              <h3 class="font-orbitron text-lg text-gray-400 mb-4">Materials</h3>
              <div class="space-y-6 flex-grow flex flex-col justify-center">
                <!-- Shards -->
                <div class="relative">
                  <div class="w-20 h-20 mx-auto flex items-center justify-center" [class.animate-fusion-material-use]="isFusing()">
                    <div class="w-full h-full bg-purple-900/50 border-2 border-purple-500 rounded-full flex items-center justify-center">
                      <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-purple-300" viewBox="0 0 20 20" fill="currentColor"><path d="M10 12.5a2.5 2.5 0 100-5 2.5 2.5 0 000 5z" /><path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" /></svg>
                    </div>
                  </div>
                   <p class="font-semibold text-base mt-2" [class.text-green-400]="heroShards() >= cost.shards" [class.text-red-400]="heroShards() < cost.shards">üíß {{ formatNumber(heroShards()) }} / {{ formatNumber(cost.shards) }}</p>
                </div>

                <!-- Gold -->
                <div>
                   <p class="font-semibold text-base" [class.text-green-400]="gameService().gameState().gold >= cost.gold" [class.text-red-400]="gameService().gameState().gold < cost.gold">üí∞ {{ formatNumber(cost.gold) }}</p>
                </div>
              </div>
            </div>
            
            <!-- ARROW -->
            <div class="col-span-1 flex justify-center">
              <svg xmlns="http://www.w3.org/2000/svg" class="h-12 w-12 text-gray-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3" /></svg>
            </div>
            
            <!-- RESULT -->
            <div class="col-span-2 flex flex-col items-center justify-start p-4 bg-gray-900/50 rounded-lg h-full">
                <h3 class="font-orbitron text-lg text-gray-400 mb-4">{{ hero.name }}</h3>
                <div class="relative mb-4">
                  <div class="w-24 h-24 rounded-lg border-4 flex items-center justify-center text-4xl font-orbitron z-10 bg-gray-800" [class]="getRarityBorderClass(hero.rarity)" [class.animate-fusion-hero-sparkle]="isFusing()">
                      {{ getHeroInitials(hero.name) }}
                  </div>
                   @if(fusionSuccess()) {
                    <div class="absolute inset-0 flex items-center justify-center z-20 pointer-events-none">
                        <div class="text-xl font-bold text-yellow-300 bg-black/80 px-3 py-1 rounded-lg animate-level-up-fade-out">ASCENDED!</div>
                    </div>
                   }
                </div>
                <div class="space-y-2 text-sm text-center">
                   <div>
                      <p class="text-gray-400">Ascension Level</p>
                      <p class="font-semibold text-lg flex items-center justify-center gap-2">
                         <span class="text-purple-300">‚≠ê {{ hero.ascensionLevel }}</span>
                         <span class="text-gray-400">‚Üí</span>
                         <span class="text-green-400">‚≠ê {{ afterStats.ascensionLevel }}</span>
                      </p>
                   </div>
                   <div>
                      <p class="text-gray-400">DPS</p>
                       <p class="font-semibold text-lg flex items-center justify-center gap-2">
                         <span class="text-purple-300">{{ formatNumber(hero.currentDps) }}</span>
                         <span class="text-gray-400">‚Üí</span>
                         <span class="text-green-400">{{ formatNumber(afterStats.dps) }}</span>
                      </p>
                   </div>
                </div>
            </div>
          </div>
          
          <button (click)="executeFusion()" [disabled]="!canFuse() || isFusing()" class="w-full py-3 bg-purple-600 text-white font-bold text-lg rounded-md hover:bg-purple-700 transition-all disabled:bg-gray-600 disabled:cursor-not-allowed">
            @if(isFusing()) {
              <span>Fusing...</span>
            } @else {
              <span>Ascend</span>
            }
          </button>
        </div>
      } @else {
        <div class="text-center text-gray-500">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-24 w-24 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 4v16m8-8H4" /></svg>
          <h2 class="mt-4 text-2xl font-orbitron">Select a Hero</h2>
          <p>Choose an unlocked hero from the list to see their ascension requirements.</p>
        </div>
      }
    </div>
  </div>
</div>
