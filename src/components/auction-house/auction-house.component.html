<div class="h-full w-full relative overflow-hidden flex flex-col p-4 bg-pattern-auction animate-fadeIn">
  <header class="relative z-10 text-center mb-4 flex justify-between items-center">
    <h1 class="text-3xl font-orbitron text-yellow-300 drop-shadow-lg [text-shadow:_0_2px_2px_rgb(0_0_0_/_50%)]">Auction House</h1>
    <div class="font-semibold bg-gray-900/50 px-4 py-1 rounded-full border border-yellow-400/80">
      <span class="shimmer-text-gold">ðŸ’° {{ formatNumber(gameService().gameState().gold) }}</span>
    </div>
  </header>
  
  <div class="relative z-10 mb-4 flex space-x-1 sm:space-x-2 border-b-2 border-yellow-800/50">
    <button (click)="activeTab.set('browse')" class="px-4 py-2 text-base font-orbitron transition-all flex-grow" [class.text-yellow-300]="activeTab() === 'browse'" [class.border-b-2]="activeTab() === 'browse'" [class.border-yellow-300]="activeTab() === 'browse'" [class.text-gray-400]="activeTab() !== 'browse'">Browse</button>
    <button (click)="activeTab.set('bids')" class="px-4 py-2 text-base font-orbitron transition-all flex-grow" [class.text-yellow-300]="activeTab() === 'bids'" [class.border-b-2]="activeTab() === 'bids'" [class.border-yellow-300]="activeTab() === 'bids'" [class.text-gray-400]="activeTab() !== 'bids'">Bids</button>
    <button (click)="activeTab.set('auctions')" class="px-4 py-2 text-base font-orbitron transition-all flex-grow" [class.text-yellow-300]="activeTab() === 'auctions'" [class.border-b-2]="activeTab() === 'auctions'" [class.border-yellow-300]="activeTab() === 'auctions'" [class.text-gray-400]="activeTab() !== 'auctions'">My Auctions</button>
  </div>
  
  <main class="relative z-10 flex-grow overflow-y-auto pr-2">
    @switch (activeTab()) {
      @case('browse') {
        <div class="animate-fadeIn">
          <div class="grid grid-cols-1 gap-2">
            @for(auction of auctions(); track auction.id) {
              <div class="bg-slate-800/70 p-3 rounded-lg flex items-center gap-3 border border-slate-700 hover:bg-slate-700/70 transition-colors">
                <div class="flex-grow">
                  <p class="font-bold" [class]="getRarityTextColor(auction.item.rarity)" [appTooltip]="getTooltip(auction.item)">{{ auction.item.name }}</p>
                  <p class="text-xs text-gray-400">Seller: {{ auction.seller }} | Time Left: <span class="text-yellow-400">{{ auction.timeLeft }}</span></p>
                </div>
                <div class="text-right flex-shrink-0">
                  <p class="font-semibold text-yellow-300">ðŸ’° {{ formatNumber(auction.buyoutPrice) }}</p>
                  <button (click)="buyoutItem(auction.id)" [disabled]="gameService().gameState().gold < auction.buyoutPrice" class="px-3 py-1 mt-1 bg-green-600 text-white text-xs font-bold rounded hover:bg-green-700 disabled:bg-gray-600 disabled:cursor-not-allowed">Buyout</button>
                </div>
              </div>
            } @empty {
              <p class="text-center text-gray-500 italic py-8">No auctions found.</p>
            }
          </div>
        </div>
      }
      @case('bids') {
        <div class="text-center text-gray-500 italic py-16 animate-fadeIn">
          <p>Bidding on items will be available in a future update.</p>
        </div>
      }
      @case('auctions') {
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-4 animate-fadeIn">
          <!-- Create Auction Panel -->
          <div class="bg-slate-800/50 p-4 rounded-lg border border-slate-700">
            <h3 class="font-orbitron text-xl text-center mb-3">Create Auction</h3>
            <div class="bg-gray-900/50 p-3 rounded-lg min-h-[6rem] flex items-center justify-center text-center">
              @if(itemToSell(); as item) {
                <div>
                  <p class="font-bold" [class]="getRarityTextColor(item.rarity)">{{ item.name }}</p>
                  <p class="text-sm text-green-400">{{ formatBonus(item) }}</p>
                </div>
              } @else {
                <p class="text-gray-500 italic">Select an item from your inventory.</p>
              }
            </div>
            <div class="mt-3">
              <label for="buyout-price" class="block text-sm font-medium text-gray-300">Buyout Price:</label>
              <input type="number" id="buyout-price" [(ngModel)]="sellPrice" placeholder="e.g., 10000" class="mt-1 w-full bg-gray-700 border border-gray-600 rounded-md p-2 focus:ring-yellow-500 focus:border-yellow-500">
            </div>
            <button (click)="createAuction()" [disabled]="!itemToSell() || !sellPrice() || sellPrice()! <= 0" class="w-full mt-4 py-2 bg-yellow-600 text-black font-bold rounded-md hover:bg-yellow-700 disabled:bg-gray-600 disabled:text-white">Create Auction</button>
          </div>
          <!-- Inventory Panel -->
          <div class="bg-slate-800/50 p-2 rounded-lg border border-slate-700 flex flex-col">
            <h3 class="font-orbitron text-lg text-center mb-2">Your Inventory</h3>
            <div class="flex-grow overflow-y-auto space-y-1 pr-1">
              @for(item of inventoryItems(); track item.id) {
                <div (click)="itemToSell.set(item)" class="p-2 rounded-md cursor-pointer hover:bg-gray-700/70" [class.bg-yellow-900/50]="itemToSell()?.id === item.id">
                  <p class="font-semibold text-sm" [class]="getRarityTextColor(item.rarity)">{{ item.name }}</p>
                </div>
              } @empty {
                <p class="text-center text-gray-500 italic py-4 text-sm">No items to sell.</p>
              }
            </div>
          </div>
          <!-- Player Auctions List -->
          <div class="lg:col-span-2 bg-slate-800/50 p-3 rounded-lg border border-slate-700">
            <h3 class="font-orbitron text-lg text-center mb-2">Your Active Auctions</h3>
            @for(auction of playerAuctions(); track auction.id) {
              <div class="bg-gray-900/50 p-2 rounded flex justify-between items-center">
                <p [class]="getRarityTextColor(auction.item.rarity)">{{ auction.item.name }}</p>
                <p class="font-semibold text-yellow-300">ðŸ’° {{ formatNumber(auction.buyoutPrice) }}</p>
              </div>
            } @empty {
              <p class="text-center text-gray-500 italic text-sm py-2">You have no active auctions.</p>
            }
          </div>
        </div>
      }
    }
  </main>
  
  @if(purchaseNotification(); as message) {
    <div class="absolute bottom-4 right-4 z-50 bg-green-600 text-white font-bold px-4 py-2 rounded-lg shadow-lg animate-drop-notification">
        {{ message }}
    </div>
  }
</div>