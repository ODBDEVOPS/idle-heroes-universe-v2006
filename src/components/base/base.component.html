<div class="h-full w-full bg-gray-800 p-4 sm:p-6 lg:p-8 flex flex-col items-center overflow-y-auto font-sans">
  <div class="w-full max-w-7xl">

    <!-- Header -->
    <header class="text-center mb-6">
      <h1 class="text-3xl sm:text-4xl lg:text-5xl font-orbitron text-purple-300 drop-shadow-lg">Base Command</h1>
      <p class="text-purple-200/70 text-sm sm:text-base">Your central hub for operations.</p>
    </header>

    <!-- Core Actions Grid -->
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6 mb-6">
      <!-- Combat Ops -->
      <div (click)="navigateTo('combat')" class="group relative bg-gray-900/50 p-4 rounded-lg border-2 border-red-500/30 hover:border-red-500/80 hover:bg-red-900/20 transition-all duration-300 cursor-pointer shadow-lg overflow-hidden">
        <h2 class="text-xl font-orbitron text-red-300">Combat Ops</h2>
        <p class="text-sm text-gray-400">Return to the front lines and continue your advance.</p>
        <div class="absolute -bottom-4 -right-4 text-red-500/10 group-hover:text-red-500/20 text-6xl transition-colors duration-300 group-hover:scale-110">âš”ï¸</div>
      </div>

      <!-- Team Hub -->
      <div (click)="navigateTo('teamHub')" class="group relative bg-gray-900/50 p-4 rounded-lg border-2 border-blue-500/30 hover:border-blue-500/80 hover:bg-blue-900/20 transition-all duration-300 cursor-pointer shadow-lg overflow-hidden">
        <h2 class="text-xl font-orbitron text-blue-300">Team Hub</h2>
        <p class="text-sm text-gray-400">Manage your active team, presets, and view roster.</p>
        <div class="absolute -bottom-4 -right-4 text-blue-500/10 group-hover:text-blue-500/20 text-6xl transition-colors duration-300 group-hover:scale-110">ğŸ‘¥</div>
      </div>
      
      <!-- Summoning Gate -->
      <div (click)="navigateTo('summon')" class="group relative bg-gray-900/50 p-4 rounded-lg border-2 border-purple-500/30 hover:border-purple-500/80 hover:bg-purple-900/20 transition-all duration-300 cursor-pointer shadow-lg overflow-hidden">
        <h2 class="text-xl font-orbitron text-purple-300">Summoning Gate</h2>
        <p class="text-sm text-gray-400">Recruit new heroes to join your cause.</p>
        <div class="absolute -bottom-4 -right-4 text-purple-500/10 group-hover:text-purple-500/20 text-6xl transition-colors duration-300 group-hover:scale-110">âœ¨</div>
      </div>
      
       <!-- Cosmic Emporium (Shop) -->
      <div (click)="navigateTo('shop')" class="group relative bg-gray-900/50 p-4 rounded-lg border-2 border-yellow-500/30 hover:border-yellow-500/80 hover:bg-yellow-900/20 transition-all duration-300 cursor-pointer shadow-lg overflow-hidden">
        <h2 class="text-xl font-orbitron text-yellow-300">Cosmic Emporium</h2>
        <p class="text-sm text-gray-400">Purchase limited-time offers and resources.</p>
        <div class="absolute -bottom-4 -right-4 text-yellow-500/10 group-hover:text-yellow-500/20 text-6xl transition-colors duration-300 group-hover:scale-110">ğŸ›ï¸</div>
      </div>

    </div>

    <!-- Active Operations -->
    <div class="bg-black/20 p-4 rounded-xl border border-gray-700/50 mb-6">
      <h2 class="text-2xl font-orbitron text-gray-300 text-center mb-4">Active Operations</h2>
      <div class="space-y-4">
        
        <!-- Gold Mine -->
        @if (activeMiningOperation(); as op) {
          <div class="bg-gray-900/50 p-3 rounded-lg flex items-center gap-4">
            <div class="text-3xl">â›ï¸</div>
            <div class="flex-grow">
              <div class="flex justify-between items-baseline mb-1">
                <span class="font-bold text-yellow-300">{{ op.name }}</span>
                <span class="text-sm text-gray-400">{{ formatDuration(op.remainingSeconds) }}</span>
              </div>
              <div class="w-full bg-gray-700 rounded-full h-2.5">
                <div class="bg-yellow-500 h-2.5 rounded-full" [style.width.%]="op.progress"></div>
              </div>
            </div>
            @if (op.remainingSeconds <= 0) {
              <button (click)="claimMiningReward()" class="bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-1 px-3 rounded animate-pulse">Claim</button>
            }
          </div>
        } @else {
           <div (click)="isGoldMineModalOpen.set(true)" class="bg-gray-900/50 p-3 rounded-lg flex items-center gap-4 text-gray-500 hover:bg-gray-800/50 hover:text-yellow-300 cursor-pointer transition-colors">
              <div class="text-3xl">â›ï¸</div>
              <p>Gold Mine is idle. Click to start an operation.</p>
           </div>
        }
        
        <!-- Expeditions -->
        @for (exp of activeExpeditions(); track exp.startTime) {
           <div class="bg-gray-900/50 p-3 rounded-lg flex items-center gap-4">
            <div class="text-3xl">ğŸ—ºï¸</div>
            <div class="flex-grow">
              <div class="flex justify-between items-baseline mb-1">
                <span class="font-bold text-green-300">{{ exp.name }}</span>
                <span class="text-sm text-gray-400">{{ formatDuration(exp.remainingSeconds) }}</span>
              </div>
            </div>
             @if (exp.remainingSeconds <= 0) {
              <button (click)="gameService().claimExpedition(exp)" class="bg-green-600 hover:bg-green-700 text-white font-bold py-1 px-3 rounded animate-pulse">Claim</button>
            }
          </div>
        }

        <!-- Dungeon Runs -->
        @for(run of activeDungeonRuns(); track run.startTime) {
           <div class="bg-gray-900/50 p-3 rounded-lg flex items-center gap-4">
            <div class="text-3xl">ğŸ°</div>
            <div class="flex-grow">
              <div class="flex justify-between items-baseline mb-1">
                <span class="font-bold text-cyan-300">{{ run.name }} [{{ run.difficulty }}]</span>
                <span class="text-sm text-gray-400">{{ formatDuration(run.remainingSeconds) }}</span>
              </div>
            </div>
             @if (run.remainingSeconds <= 0) {
              <button (click)="gameService().claimDungeonRun(run)" class="bg-cyan-600 hover:bg-cyan-700 text-white font-bold py-1 px-3 rounded animate-pulse">Claim</button>
            }
          </div>
        }
        
        @if (activeMiningOperation() === null && activeExpeditions().length === 0 && activeDungeonRuns().length === 0) {
            <p class="text-center text-gray-500 italic py-4">No active operations.</p>
        }
      </div>
    </div>

    <!-- Navigation Grid -->
    <div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-4 sm:gap-6">
      <div (click)="navigateTo('forge')" class="base-nav-card border-orange-500/50 hover:bg-orange-900/30 hover:border-orange-500"><h3 class="text-orange-300">Forge</h3><div class="nav-icon">ğŸ”¥</div></div>
      <div (click)="navigateTo('tower')" class="base-nav-card border-gray-400/50 hover:bg-gray-700/30 hover:border-gray-400"><h3 class="text-gray-300">Tower of Trials</h3><div class="nav-icon">ğŸ—¼</div></div>
      <div (click)="navigateTo('expeditions')" class="base-nav-card border-green-500/50 hover:bg-green-900/30 hover:border-green-500"><h3 class="text-green-300">Expeditions</h3><div class="nav-icon">ğŸ—ºï¸</div></div>
      <div (click)="navigateTo('dungeons')" class="base-nav-card border-cyan-500/50 hover:bg-cyan-900/30 hover:border-cyan-500"><h3 class="text-cyan-300">Dungeons</h3><div class="nav-icon">ğŸ°</div></div>
      <div (click)="navigateTo('celestialShrine')" class="base-nav-card border-yellow-400/50 hover:bg-yellow-800/30 hover:border-yellow-400"><h3 class="text-yellow-300">Celestial Shrine</h3><div class="nav-icon">ğŸŒŸ</div></div>
      <div (click)="navigateTo('alchemyLab')" class="base-nav-card border-purple-500/50 hover:bg-purple-900/30 hover:border-purple-500"><h3 class="text-purple-300">Alchemy Lab</h3><div class="nav-icon">ğŸ’§</div></div>
      <div (click)="navigateTo('dimensionalRift')" class="base-nav-card border-violet-500/50 hover:bg-violet-900/30 hover:border-violet-500"><h3 class="text-violet-300">Dimensional Rift</h3><div class="nav-icon">ğŸŒ€</div></div>
      <div (click)="isWarRoomModalOpen.set(true)" class="base-nav-card border-sky-500/50 hover:bg-sky-900/30 hover:border-sky-500"><h3 class="text-sky-300">War Room</h3><div class="nav-icon">ğŸ“Š</div></div>
    </div>
  </div>

  <!-- Gold Mine Modal -->
  @if(isGoldMineModalOpen()) {
    <div class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 animate-modal-fade-in" (click)="isGoldMineModalOpen.set(false)">
      <div class="bg-gray-800 rounded-lg shadow-xl w-full max-w-lg p-6 border-2 border-yellow-500 text-center" (click)="$event.stopPropagation()">
          <h2 class="text-2xl font-orbitron text-yellow-400 mb-4">Gold Mine Operations</h2>
          <div class="space-y-3">
            @for(op of availableMiningOperations(); track op.id) {
              <button (click)="startMiningOperation(op.id)" [disabled]="!op.isAvailable" class="w-full p-3 rounded-lg text-left transition-colors disabled:opacity-50 disabled:cursor-not-allowed" [class]="op.isAvailable ? 'bg-gray-700/80 hover:bg-yellow-600/50' : 'bg-gray-900/50'">
                <div class="flex justify-between items-center">
                  <span class="font-bold">{{ op.name }}</span>
                  <span class="text-sm font-mono">{{ formatDuration(op.durationSeconds) }}</span>
                </div>
                <p class="text-sm text-gray-400 mt-1">{{ op.description }}</p>
                <div class="flex justify-between items-center mt-2 text-sm">
                   <span class="text-yellow-300">Reward: ğŸ’° {{ formatNumber(op.goldReward) }}</span>
                   @if (!op.isAvailable) {
                     <span class="text-red-400">Requires Stage {{ op.stageRequirement }}</span>
                   }
                </div>
              </button>
            }
          </div>
          <button (click)="isGoldMineModalOpen.set(false)" class="mt-6 py-2 px-4 bg-gray-600 text-white font-bold rounded-md hover:bg-gray-700 transition-colors">Close</button>
      </div>
    </div>
  }
  
  <!-- War Room Modal -->
  @if(isWarRoomModalOpen()) {
    <div class="fixed inset-0 bg-black/70 flex items-center justify-center z-50 animate-modal-fade-in" (click)="isWarRoomModalOpen.set(false)">
      <div class="bg-gray-800 rounded-lg shadow-xl w-full max-w-lg p-6 border-2 border-sky-500" (click)="$event.stopPropagation()">
          <h2 class="text-2xl font-orbitron text-sky-400 mb-4 text-center">War Room Analysis</h2>
          
          @if(analysisResult(); as result) {
            <div class="bg-gray-900/50 p-4 rounded-lg">
              <h3 class="font-bold text-lg text-gray-200 mb-2">Strategic Report:</h3>
              <div class="text-gray-300 whitespace-pre-wrap font-mono text-sm leading-relaxed">
                @for(line of result.split('* '); track line) {
                  @if(line.trim()) {
                    <p class="mb-2 pl-2 border-l-2 border-sky-500/50"> â€¢ {{ line.trim() }}</p>
                  }
                }
              </div>
            </div>
            <div class="text-center mt-4">
               <button (click)="analysisResult.set(null)" class="py-2 px-4 bg-sky-600 text-white font-bold rounded-md hover:bg-sky-700 transition-colors">New Analysis</button>
            </div>
          } @else if(analysisError(); as error) {
             <div class="bg-red-900/30 p-4 rounded-lg text-center">
                <p class="text-red-300 font-semibold">{{ error }}</p>
             </div>
             <div class="text-center mt-4">
               <button (click)="analysisError.set(null)" class="py-2 px-4 bg-gray-600 text-white font-bold rounded-md hover:bg-gray-700 transition-colors">Close</button>
            </div>
          } @else {
            <div class="text-center">
              <p class="text-gray-300 mb-4">Request a strategic analysis of your current progress from the AI Command Core.</p>
              <button (click)="getAnalysis()" [disabled]="isAnalysisLoading() || gameService().gameState().gold < ANALYSIS_COST"
                class="w-full py-3 bg-sky-600 text-white font-bold rounded-md hover:bg-sky-700 transition-colors disabled:bg-gray-600 disabled:cursor-not-allowed relative overflow-hidden">
                @if(isAnalysisLoading()) {
                  <span class="animate-pulse">Analyzing...</span>
                } @else {
                  <span>Request Analysis (Cost: {{ formatNumber(ANALYSIS_COST) }}ğŸ’°)</span>
                }
              </button>
              @if(gameService().gameState().gold < ANALYSIS_COST) {
                <p class="text-red-400 text-sm mt-2">Not enough gold.</p>
              }
            </div>
          }
      </div>
    </div>
  }

  <!-- Notification for claimed mining reward -->
  @if(miningClaimResult(); as reward) {
    <div class="fixed bottom-10 left-1/2 -translate-x-1/2 bg-yellow-500 text-black font-bold py-2 px-5 rounded-lg shadow-lg animate-drop-notification z-50">
        +{{ formatNumber(reward) }} ğŸ’°
    </div>
  }
</div>